{{ define "home" }}

{{ template "header" . }}
<div {{ with $.platform_css }} class="{{.}}" {{ end }}>
  <span class="platform-flag">
    {{$.platform_name}}
  </span>
</div>
<main role="main" class="home">

  <!-- The image at the top of the home page, displayed on smaller screens. -->
  <div class="home-mobile-hero-banner d-lg-none"></div>

  <div class="container-fluid">
    <div class="row">

      <div class="col-12 col-lg-12 px-10-percent">

        <div class="row hot-products-row px-xl-6">

          <div class="col-12">
            <h3>All Products</h3>
          </div>

          {{ range $.products }}
          <div class="col-md-4 hot-product-card">
            <a href="{{ $.baseUrl }}/product/{{.Item.Id}}">
              <img loading="lazy" src="{{ $.baseUrl }}{{.Item.Picture}}">
              <div class="hot-product-card-img-overlay"></div>
            </a>
            <div>
              <div class="hot-product-card-name">{{ .Item.Name }}</div>
              <div class="hot-product-card-price">{{ renderMoney .Price }}</div>
            </div>
          </div>
          {{ end }}

        </div>

        <!-- Footer for larger screens. -->
        <div class="row d-none d-lg-block home-desktop-footer-row">
          <div class="col-12 p-0">
            {{ template "footer" . }}
          </div>
        </div>

      </div>

    </div>
  </div>

</main>

<!-- Footer for smaller screens. -->
<div class="d-lg-none">
  {{ template "footer" . }}
</div>

<!-- Pop up window -->
<style>
  #popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }
  #popup {
    background: #fff;
    border-radius: 8px;
    max-width: 320px;
    width: 90%;
    padding: 16px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.2);
    font-family: inherit;
  }
  #popup h4 { margin: 0 0 8px 0; font-size: 1rem; }
  #popup p { margin: 0 0 12px 0; font-size: 0.9rem; color: #333; }
  #popup .popup-actions { text-align: right; }
  #popup .btn-close {
    background: #171515;
    color: #fff;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
  }
  #popup .btn-close:hover { opacity: 0.95; }
  #popup .btn-close:focus {
    outline: none;
  }
</style>

<div id="popup-overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div id="popup" role="document" aria-labelledby="popup-title">
    <h4 id="popup-title">Outfit-Recommendation</h4>
    <p id="popup-message">Loading Outfit...</p>
    <div class="popup-actions">
      <button class="btn-close" type="button" aria-label="close">close</button>
    </div>
  </div>
</div>

<script>
  (function(){
    const overlay = document.getElementById('popup-overlay');
    const closeBtn = overlay.querySelector('.btn-close');
    const messageEl = document.getElementById('popup-message');
    const popupUrl = '{{ $.baseUrl }}/popup-message';

function showPopup() {
  fetch(popupUrl, { credentials: 'same-origin' })
    .then(resp => {
      if (!resp.ok) throw new Error('network');
      return resp.text();
    })
    .then(text => {
      try {
        const data = JSON.parse(text);
        if (data.image) {
      messageEl.innerHTML = `<div style="text-align:center;">
                         <img src="${data.image}" style="max-width:50%; border-radius:4px; margin-bottom:8px; display:block; margin-left:auto; margin-right:auto;" alt="Outfit">
                         <img src="${data.image2}" style="max-width:50%; border-radius:4px; margin-bottom:8px; display:block; margin-left:auto; margin-right:auto;" alt="Outfit">
                         <img src="${data.image3}" style="max-width:50%; border-radius:4px; margin-bottom:8px; display:block; margin-left:auto; margin-right:auto;" alt="Outfit">
                         <p>${data.text || ''}</p>
                       </div>`;
        } else {
          messageEl.textContent = text || 'no content';
        }
      } catch {
        messageEl.textContent = text || 'no content';
      }
    })
    .catch(() => {
      messageEl.textContent = 'Error whilst loading the content.';
    })
    .finally(() => {
      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden', 'false');
      closeBtn.focus();
    });
}

    function hidePopup() {
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden', 'true');
    }

    window.addEventListener('load', function(){
      setTimeout(showPopup, 1000);
    });

    closeBtn.addEventListener('click', hidePopup);

    overlay.addEventListener('click', function(e){
      if (e.target === overlay) hidePopup();
    });

    window.addEventListener('keydown', function(e){
      if (e.key === 'Escape') hidePopup();
    });
  })();
</script>


{{ end }}
